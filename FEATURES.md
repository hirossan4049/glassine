# Glassine 機能詳細

## 主要機能

### 1. イベント作成（主催者）

**アカウント不要の即座利用**
- ログインやアカウント登録なしで、すぐにイベントを作成可能
- 作成したイベントには固有のIDと2種類のトークンが自動生成される

**候補日時の選択**
- 週×時間のグリッドインターフェース（月曜〜日曜、9:00〜23:00）
- 30分単位のスロット
- ドラッグ&ペイントで複数スロットを一括選択
- スマホでもタッチ操作で簡単に選択可能

**イベント情報**
- タイトル（必須）
- 説明（任意）
- タイムゾーン設定（デフォルト: Asia/Tokyo）

### 2. URL共有システム

**3種類のURL**

1. **編集用URL** (`/e/{eventId}?token={editToken}`)
   - 主催者専用
   - 回答状況の確認
   - 最終日程の確定
   - URLの流出防止のため、慎重に管理

2. **参加者用URL** (`/r/{eventId}?token={viewToken}`)
   - 参加者が回答を入力
   - 複数回の回答・更新が可能
   - SNSで簡単にシェア可能

3. **閲覧用URL** (`/v/{eventId}?token={viewToken}`)
   - 誰でも結果を確認可能
   - 確定済みの日程が表示される
   - 参加状況の可視化

**セキュリティ**
- トークンは暗号学的に安全な乱数で生成（32文字）
- 編集用と閲覧用でトークンを分離
- URLを知らなければアクセス不可

### 3. 参加者の回答機能

**可否の入力**
- ○（参加可能）: 緑色
- △（参加可能かも）: 黄色
- ×（参加不可）: 赤色
- クリック/ドラッグで状態が循環的に変化

**インターフェース**
- タッチ操作対応（スマホ、タブレット）
- マウス操作対応（PC）
- 長押しドラッグで複数セル選択
- リアルタイムのビジュアルフィードバック

**回答の管理**
- 名前の入力（必須）
- 複数回の回答・修正が可能
- 送信後の確認メッセージ

### 4. 集計と推薦機能

**自動集計**
- 各候補時間ごとの参加可能人数を集計
- ○、△、×の人数を個別にカウント
- スコアリング: ○ × 2 + △ × 1

**最適枠の推薦**
- スコアの高い順に候補を表示
- 上位10件の候補を一覧表示
- 視覚的に分かりやすい表形式

**確定機能**
- 主催者が最終的な日程を選択・確定
- 確定済みの枠は緑色でハイライト
- 閲覧用URLで確定日程を共有

### 5. OGP（Open Graph Protocol）対応

**動的OG画像生成**
- イベント毎にカスタマイズされたOG画像
- タイトルを含んだSVG画像を自動生成
- エンドポイント: `/og/{eventId}.png?token={token}`

**ページ別メタデータ**
- イベントページ: イベント名と説明を表示
- ホームページ: サービス概要を表示
- Twitter Card対応

**SNSキャッシュ対策**
- イベント作成時刻をキャッシュバスターとして使用
- 内容更新時に適切にキャッシュが更新される
- Facebook、Twitter、LINEなどで正しくプレビュー表示

### 6. レスポンシブデザイン

**モバイル対応**
- タッチジェスチャーのサポート
- 小画面でもスクロール可能なグリッド
- 指でのドラッグ&ペイント

**デスクトップ対応**
- マウス操作に最適化
- 大画面での視認性向上
- ホバーエフェクト

**横スクロール**
- 画面幅に応じて自動調整
- グリッドが画面に収まらない場合は横スクロール

## 技術仕様

### データ構造

**30分スロット**
- 開始時刻と終了時刻をUnixタイムスタンプで保存
- 1スロット = 30分間
- データベースで効率的に検索・集計可能

**データベーススキーマ**
```sql
events          -- イベント情報
event_slots     -- 候補時間スロット
responses       -- 参加者の回答
response_slots  -- 各スロットの可否
```

**正規化**
- 適切な外部キー制約
- カスケード削除対応
- インデックス最適化

### パフォーマンス

**Cloudflareエッジネットワーク**
- 世界中のエッジロケーションから配信
- 低レイテンシー
- 高可用性

**D1データベース**
- SQLiteベースの高速データベース
- エッジでのクエリ実行
- 自動バックアップ

**Viteビルド**
- 最適化されたバンドル
- Tree-shaking
- コード分割

### セキュリティ

**XSS対策**
- HTML特殊文字のエスケープ
- React自動エスケープ
- SVG内のテキストエスケープ

**CSRF対策**
- トークンベース認証
- ステートレス設計

**SQLインジェクション対策**
- プリペアドステートメント使用
- パラメータバインディング

**暗号化**
- Web Crypto APIによる安全な乱数生成
- HTTPS通信（Cloudflare自動対応）

## 今後の拡張可能性

### 追加機能候補

1. **コメント機能**
   - 参加者がコメントを残せる
   - 質問や要望の共有

2. **通知機能**
   - 新しい回答があった時の通知
   - 確定時の自動通知

3. **CSV/iCalエクスポート**
   - カレンダーアプリへのインポート
   - 回答データのエクスポート

4. **カスタマイズ**
   - カラーテーマの変更
   - ロゴのアップロード
   - カスタムドメイン

5. **統計・分析**
   - 回答率の可視化
   - 人気時間帯の分析
   - グラフ表示

6. **多言語対応**
   - 英語、中国語などの追加
   - 自動言語検出

7. **リマインダー**
   - イベント前日の自動リマインド
   - 未回答者への催促

### 拡張性

**モジュール設計**
- コンポーネント単位で独立
- 新機能の追加が容易
- APIエンドポイントの拡張可能

**データベース拡張**
- 新しいテーブルの追加が容易
- マイグレーション管理

**UIコンポーネント**
- 再利用可能な設計
- カスタマイズ可能なスタイル
